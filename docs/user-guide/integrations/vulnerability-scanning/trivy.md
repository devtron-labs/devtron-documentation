# Security Integration (Trivy)

**Prerequisite**: **For OSS users only**: Please make sure to install **Build and Deploy (CI/CD)** integration. To install it, click [here](../integrations/build-and-deploy-ci-cd.md).

Trivy integration enables you to scan the vulnerabilities for images, code and manifests during the time of execution.

Security is a serious concern before deploying any application. Applications can be vulnerable due to insecure code, outdated and third party libraries or misconfigured manifests, therefore, it is important to know how secure the application is, before it is deployed. To help identify these vulnerabilities, Devtron provides **Trivy** to scan source code, images and manifests for vulnerabilities.

---

## Install Trivy Integration
### For Enterprise Users

Trivy is enabled by default for Devtron Enterprise allowing enterprise users to perform vulnerability scans without any prerequisites.

### For OSS Users

To install **Trivy** integration follow the steps:

1. On the **Devtron Stack Manager > Discover** page, click the **Vulnerability Scanning (Trivy)**.

<!-- image  -->

2. On the **Discover Integrations/Vulnerability Scanning (Trivy)** page, click **Install**.

<!-- image -->

The installation status may be one of the following:
 
| Installation status | Description |
| --- | --- |
| `Install` | The integration is not yet installed. |
| `Initializing` | The installation is being initialized. |
| `Installing` | The installation is in progress. The logs are available to track the progress. |
| `Failed` | Installation failed and the logs are available to troubleshoot. You can retry the installation or [contact support](https://discord.devtron.ai/). |
| `Installed` | The integration is successfully installed and available on the **Installed** page. |
| `Request timed out` | The request to install has hit the maximum number of retries. You may retry the installation or [contact support](https://discord.devtron.ai/) for further assistance. |
 
> A list of installed integrations can be viewed on the **Devtron Stack Manager > Installed** page.
 
To update an installed integration, please [update Devtron](../../../setup/upgrade/upgrade-devtron-ui.md).

---

## Using Trivy

In Devtron, **Trivy** can be used to scan vulnerabilities across various types of applications such as Devtron Apps, Helm Apps, Flux and ArgoCD Apps 

Trivy can provide 3 types of scans based on type of the application i.e., Image scan, Kubernetes Manifest Scan and Code Scan

| Type of scan | Description |
| :--- |:---|
| Image Scan  | Enables scanning for build **Images** before deployment.|
| Manifest Scan | The **Code Scan** plugin of Devtron allows you to perform the code scanning using Trivy. |
| Code Scan (requires `Code Scan` Plugin) |The **Code Scan** plugin of Devtron allows you to perform the code scanning using Trivy. |

Refer the below table to see which type of scans are supported across different application types in Devtron.

| Application Type | Image Scan | Code Scan (Requires Plugin) | Manifest Scan |
| :--- |:--- | :--- | :--- |
| Devtron Apps | ✅ | ✅ | ✅ |
| Helm Apps | ✅ | ❌ |  ✅ |
| ArgoCD Apps | ✅ | ❌ | ✅ | 
| FluxCD Apps | ✅ | ❌ | ✅ |

---

## Devtron Apps
### Where to Initiate the Scan for Devtron Apps

For Devtron Apps, you can enable scanning by 2 ways

| Field Name | Scans Supported |Description |
| :--- |:---|:---|
| Scan for vulnerabilities |Image scan<br>Kubernetes Manifest scan | Enables scanning for build **Images** and **Kubernetes Manifests**  before deployment.|
| Code Scan (Plugin) | Code Scan |The **Code Scan** plugin of Devtron allows you to perform the code scanning using Trivy. |

 #### Enable Scan for vulnerabilities option 

 {% hint style="warning" %}
 ### Who Can Perform This Action?
 Users need to have Admin permission or above (along with access to the environment and application) to enable the **Scan for vulnerabilities** option.
 {% endhint %}
 
 Devtron's CI pipeline provides a [**Scan for vulnerabilities**](../../creating-application/workflow/ci-pipeline.md#scan-for-vulnerabilities) option as shown below. Once you enable this option, it will automatically scan the image and kubernetes manifests for vulnerabilities. 
 
 Follow the below steps to enable the **Scan for vulnerabilities** option
 
 ![Figure 1: Scan for vulnerabilities](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/security-features/new/enable-image-scan.jpg)
 
 1. Navigate to **Devtron Apps** → **Select your app** → **Configurations** → **Workflow Editor**.

 2. Select the specific build pipeline for which you want to enable scanning, a **Edit deployment pipeline** modal window will appear.

 3. Enable the **Scan for vulnerabilities** toggle in the **Build stage**.

 4. Select **Update pipeline** to save the configuration.

 5. Trigger the next CI pipeline build to scan for vulnerabilities.
 
 Refer [Security Features](../../security-features/security-scans.md) to know more.



| Location | Image Scan | Code Scan (Requires Plugin) | Manifest Scan |
| :--- |:--- | :--- | :--- |
| App Details                | ✅         | ✅                  | ✅             |
| Select Image Artifact      | ✅         | ✅ (Not in summary) | ❌             |
| CI History (Job/Build)     | ✅         | ✅                  | ❌             |
| Pre-Post Deployment History| ✅         | ✅                  | ❌             |

### Helm Apps 

| Location | Image Scan | Manifest Scan |
| :--- | :--- | :--- |
| App Details | ✅ | ✅ |
| Deployment History | ✅ | ✅ |

### ArgoCD and FluxCD Apps 

| Location | Image Scan |
| :--- |:---|
| App Details | ✅ |