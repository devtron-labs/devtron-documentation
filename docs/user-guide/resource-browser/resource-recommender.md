# Resource Recommender

## Introduction <a href="https://devtron.ai/pricing"><img src="https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/elements/EnterpriseTag.svg" className="enterprise-badge-img" /></a>

**Resource Recommender** is a Devtron feature that analyzes the history of resource usage (such as CPU and memory) for Kubernetes workloads in a specific cluster and generates data-backed recommendations for optimal resource allocation. 

These recommendations are generated by a background job that runs daily at a specific time by default, using resource usage metrics collected from Prometheus. Job frequency can be customized by modifying the configuration in the ConfigMap. Refer to [Modify Resource Recommender Job Schedule](#modify-resource-recommender-job-schedule) to learn more.

It helps users eliminate manual guesswork, reduce over-provisioning, and prevent performance issues caused by under-provisioned workloads.

:::info Prerequisites
* Prometheus endpoint must be configured. Refer to the [Cluster and Environments](../global-configurations/cluster-and-environments.md#configure-prometheus-enable-application-metrics)

:::

:::caution Who Can Perform This Action?
To view recommendations, users need to have [view permissions for the specific cluster](../global-configurations/authorization/user-access.md#kubernetes-resources-permissions).

To apply recommendations, users need to have [admin permissions for the specific cluster](../global-configurations/authorization/user-access.md#kubernetes-resources-permissions).

:::

## Inspect Recommendations

To inspect the resource recommendations, follow the steps below:

1. Navigate to **Resource Browser**.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-resourse-browser.jpg)
<center>Figure 1: Navigating to Resource Browser</center>

2. Select the specific cluster for which you want to inspect the resource recommendations.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-select-cluster.jpg)
<center>Figure 2: Selecting Cluster</center>

3. Select the **Resource Recommender** tab to inspect the recommendations. 

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-click-rr-button.jpg)
<center>Figure 3: Selecting Resource Recommender</center>
      1. Each row displays workloads in that cluster, along with recommendations for CPU and memory.

           ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-each-workload.jpg)
<center>Figure 4: Displaying Workloads along with Recommendations</center> 

      2. Recommendations are shown as percentage changes by default. You can use the **Show absolute values** checkbox to see current v/s recommended values in actual units (e.g., 128Mi → 4900Ki).

           ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-absolute-values.jpg)
<center>Figure 5: Toggling 'Show Absolute Values'</center>

:::info 
 ### No Recommendations
 * In case you have just configured the Prometheus endpoint, you might face the **No recommendations yet** screen after selecting **Resource Recommender**. 
 
 * Click **Check for Recommendations** to initiate the scan, and recommendations will be available in a few minutes.
:::

4. You can inspect the resource recommendations for each workload within the cluster.
     1. If you wish, you can filter the workloads based on their `Kind` and `Namespace`.

           ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-kind.jpg)
<center>Figure 6a: Filtering via 'Kind'</center>

           ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-namespace.jpg)
<center>Figure 6b: Filtering via 'Namespace'</center>

     2. You can also search for a specific workload via the search bar based on `WORKLOAD`, `NAMESPACE`, `KIND`, `API VERSION`, and `CONTAINER NAME`. 

           ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-search.jpg)
<center>Figure 7: Filtering via Search Bar</center>

5. For each workload, recommendations can be of the following types:

 ### Types of Recommendation

 | Type  | Visual Indicator  |Description                              |
 |:---   |:---               |:---|
 |`↑`   | Red upward arrow   |Indicates that the current resource allocation is **below the recommended threshold**, and more resources should be provisioned to ensure successful builds. |
 |`↓`   | Green downward arrow |Indicates that the current resource allocation is **above the recommended requirement**, and resources can be safely reduced to optimize cost and efficiency. |
 |`0% -`| Gray dash (-)      |Indicates that the current allocation **matches the recommended value**, and no changes are needed.|
 |`No Recommendation`|`No Recommendation`| No recommendation available |

 ### Supported Resources

 | Type           |Description                              |
 |:---            |:---                                     |
 |`CPU REQUESTS`  |**CPU** guaranteed to the workload|
 |`CPU LIMITS`    |Maximum **CPU** allocatable to the workload, if available|
 |`MEM REQUESTS`  |**Memory (RAM)** guaranteed to the workload|
 |`MEM LIMITS`    |Maximum **Memory (RAM)** allocatable to the workload, if available|

6. Hover the cursor over the specific resource of the particular workload to view the recommendation.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-red.jpg)
<center>Figure 8a: Recommending for Increasing Resources</center>

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-green.jpg)
<center>Figure 8b: Recommending for Decreasing Resources</center>

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-zero.jpg)
<center>Figure 8c: Recommending to not take any action</center>

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-no-recommendation.jpg)
<center>Figure 8d: No Recommendation</center>

### Rescan for Recommendations

If you want to rescan for recommendations, use this option to fetch the most recent data for your cluster. To do so, follow the steps below:

1. Select the kebab menu (⋮) from the right side.

2. Click **Rescan for recommendations**.

3. Rescanning will start, and recommendations will be updated in few minutes.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resource-recommender-rescan.gif)
<center>Figure 9: Rescanning for Recommendations</center>

## Apply Recommendations

After inspecting the recommendations, you can directly apply them to your workloads in the following ways:

 * [Apply Per Workload](#apply-per-workload)
 * [Bulk Apply](#bulk-apply)

### Apply Per Workload

To apply recommended resources to a specific workload, follow the steps below:

1. Hover over the specific workload row and click the **Apply** button that appears on hover.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-apply.jpg)
<center>Figure 10: Selecting Workload</center>

2. A modal window will open, displaying the comparison between the current and recommended resource values for that specific workload; review the recommended changes carefully.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-compare.jpg)
<center>Figure 11: Comparing Configurations</center>

3. Click **Apply Changes** to update the resource configuration.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-apply-changes.jpg)
<center>Figure 12: Applying Changes </center>

### Bulk Apply

If you wish, you can apply recommended resource configurations to multiple or all workloads at once. To do so, follow the steps below:

1. Select the workloads for which you want to apply recommended resource configurations and click **Apply Changes**.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-apply-changes-bulk.jpg)
<center>Figure 13: Selecting Workloads</center>

2. A modal window will open, displaying the comparison between the current and recommended resource values for each workload; review the recommended changes for each workload carefully.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-compare-bulk.jpg)
<center>Figure 14: Comparing Configurations for each workload</center>

3. Click **Apply Changes** to update the resource configuration.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-apply-in-bulk.jpg)
<center>Figure 15: Applying Changes</center>

## Export Recommendations in CSV File

You can also export resource recommendations to a CSV file. To do so, follow the steps below:

1. Filter the workloads for which you want to export resource recommendations, based on their `Kind` and `Namespace`. By default, it will export resource recommendations for all workloads. 

2. Click the **Download** button; a dialog box will appear displaying that your export is ready. By default, the file will be downloaded automatically to your system. If you wish you can select **Click Here To Download Manually** to download the file manually. 

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-download.jpg)
<center>Figure 16: Clicking Download Button</center>

## Modify Resource Recommender Job Schedule

To modify the schedule of the **Resource Recommender** background job, follow the steps below:

1. In a new tab, go to **Infrastructure Management** → **Resource Browser** → (Select the Cluster for which you want to modify the resource recommender job schedule) → **Config & Storage** → **ConfigMap**

2. Select the **Orchestrator/Devtron ConfigMap**
     1. If **Devtron** is managing your setup, contact **Devtron** support to perform these changes.
     
     2. If you installed Devtron via Helm, select `devtron-cm` and click **Edit Live Manifest**.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-devtron-cm.jpg)
<center>Figure 17a: Selecting Devtron CM</center>

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-edit-live-manifest.jpg)
<center>Figure 17b: Clicking 'Edit Live Manifest'</center>

3. Edit the `KRR_SYNC_JOB_CRON_SCHEDULE` key and set the schedule according to your use case using a cron expression.

4. Click **Review and Save Changes** and a split-view will open for comparing changes.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-compare-changes.jpg)
<center>Figure 18: Comparing Changes</center>

5. Click **Apply Changes** and manifest will be updated.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-apply-changes-manifest.jpg)
<center>Figure 19: Applying Changes</center>

6. Restart the `orchestrator` or `devtron` pod to implement the changes.

      ![](https://devtron-public-asset.s3.us-east-2.amazonaws.com/images/devtron-v2/infra-management/resource-browser+/resource-recommender/resourse-recommender-restart-pod.jpg)
<center>Figure 20: Restarting Pods</center>

   
