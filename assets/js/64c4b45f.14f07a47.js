"use strict";(globalThis.webpackChunkdocdevtron=globalThis.webpackChunkdocdevtron||[]).push([[39167],{28453:(e,n,r)=>{r.d(n,{R:()=>d,x:()=>i});var s=r(96540);const t={},o=s.createContext(t);function d(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(o.Provider,{value:n},e.children)}},74585:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"setup/upgrade/devtron-upgrade-1.5.0","title":"Upgrade Devtron to 1.5.0","description":"This document outlines the step-by-step process to be followed before upgrading Devtron to version 1.5.0.","source":"@site/docs/setup/upgrade/devtron-upgrade-1.5.0.md","sourceDirName":"setup/upgrade","slug":"/setup/upgrade/devtron-upgrade-1.5.0","permalink":"/docs/setup/upgrade/devtron-upgrade-1.5.0","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Update Devtron from Devtron UI","permalink":"/docs/setup/upgrade/upgrade-devtron-ui"},"next":{"title":"Upgrading Devtron 0.6.x to 0.7.x","permalink":"/docs/setup/upgrade/devtron-upgrade-0.6.x-0.7.x"}}');var t=r(74848),o=r(28453);const d={},i="Upgrade Devtron to 1.5.0",a={},l=[{value:"Overview of the Upgrade Process",id:"overview-of-the-upgrade-process",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Steps",id:"steps",level:2},{value:"1. Apply the &#39;pre-upgrade&#39; job",id:"1-apply-the-pre-upgrade-job",level:3},{value:"2. Monitor the &#39;upgrade-init&#39; job",id:"2-monitor-the-upgrade-init-job",level:3},{value:"3. Apply the &#39;upgrade&#39; job",id:"3-apply-the-upgrade-job",level:3},{value:"Verify the Upgrade",id:"verify-the-upgrade",level:2},{value:"Potential Issues and Troubleshooting",id:"potential-issues-and-troubleshooting",level:2},{value:"Job Failure",id:"job-failure",level:3},{value:"Next Steps",id:"next-steps",level:2},{value:"Upgrade Commands",id:"upgrade-commands",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"upgrade-devtron-to-150",children:"Upgrade Devtron to 1.5.0"})}),"\n",(0,t.jsxs)(n.p,{children:["This document outlines the step-by-step process to be followed before upgrading Devtron to version ",(0,t.jsx)(n.strong,{children:"1.5.0"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"overview-of-the-upgrade-process",children:"Overview of the Upgrade Process"}),"\n",(0,t.jsx)(n.p,{children:"The upgrade process consists of three sequential Kubernetes jobs:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"devtron-pre-upgrade"}),": Prepares the environment for the upgrade."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"devtron-upgrade-init"}),": Scales down Devtron and takes the backup."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"devtron-upgrade"}),": Performs the restoration of data and scales up Devtron."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"After the completion of the above jobs, you may proceed to upgrade Devtron using the UI or command line."}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Ensure that you have ",(0,t.jsxs)(n.a,{href:"/docs/setup/install/devtron-backup",children:["deployed the ",(0,t.jsx)(n.strong,{children:"devtron-backups"})," chart"]})," and that at least one backup has been pushed successfully. ",(0,t.jsx)(n.a,{href:"https://github.com/devtron-labs/charts/blob/main/charts/devtron-backups/README.md",children:"Click here"})," to know more about the backups chart."]}),"\n",(0,t.jsxs)(n.li,{children:["You must have administrative access to the cluster where Devtron is running, along with ",(0,t.jsx)(n.code,{children:"kubectl"})," configured."]}),"\n",(0,t.jsxs)(n.li,{children:["PVC creation must not be blocked by any policy. If it is, exclude the ",(0,t.jsx)(n.code,{children:"devtroncd"})," namespace from it."]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"steps",children:"Steps"}),"\n",(0,t.jsx)(n.h3,{id:"1-apply-the-pre-upgrade-job",children:"1. Apply the 'pre-upgrade' job"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"devtron-pre-upgrade"})," job creates the necessary resources and prepares for the database backup."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Apply the devtron-pre-upgrade job\nkubectl apply -f https://raw.githubusercontent.com/devtron-labs/utilities/refs/heads/main/scripts/postgres-upgrade/devtron-pre-upgrade.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"This job will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Create a ConfigMap named ",(0,t.jsx)(n.code,{children:"devtron-postgres-upgrade"})," in the ",(0,t.jsx)(n.code,{children:"devtroncd"})," namespace."]}),"\n",(0,t.jsx)(n.li,{children:"Determine the StorageClass and size of the existing PostgreSQL PVC."}),"\n",(0,t.jsxs)(n.li,{children:["Create a new PVC named ",(0,t.jsx)(n.code,{children:"devtron-db-upgrade-pvc"})," with additional storage (+5Gi)."]}),"\n",(0,t.jsx)(n.li,{children:"Automatically apply the upgrade-init job."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To monitor the progress of this job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -f job/devtron-pre-upgrade -n devtroncd\n"})}),"\n",(0,t.jsx)(n.p,{children:"Wait for this job to complete successfully before proceeding."}),"\n",(0,t.jsx)(n.h3,{id:"2-monitor-the-upgrade-init-job",children:"2. Monitor the 'upgrade-init' job"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"devtron-upgrade-init"})," job is automatically triggered by the ",(0,t.jsx)(n.code,{children:"devtron-pre-upgrade"})," job:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"It scales down all Devtron components to ensure database consistency."}),"\n",(0,t.jsx)(n.li,{children:"Terminates active database connections."}),"\n",(0,t.jsx)(n.li,{children:"Starts the Postgres migration process."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To monitor the progress of this job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -f job/devtron-upgrade-init -n devtroncd\n"})}),"\n",(0,t.jsx)(n.p,{children:"Ensure this job completes successfully before proceeding to the next step."}),"\n",(0,t.jsx)(n.h3,{id:"3-apply-the-upgrade-job",children:"3. Apply the 'upgrade' job"}),"\n",(0,t.jsx)(n.p,{children:"Once the backup is confirmed, apply the final upgrade job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/devtron-labs/utilities/refs/heads/main/scripts/postgres-upgrade/devtron-upgrade.yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:"This job will:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Verify if the ",(0,t.jsx)(n.code,{children:"devtron-upgrade-init"})," job was successful."]}),"\n",(0,t.jsx)(n.li,{children:"Extract any nodeSelectors or tolerations from the existing PostgreSQL StatefulSet."}),"\n",(0,t.jsx)(n.li,{children:"Remove PostgreSQL 11 components."}),"\n",(0,t.jsx)(n.li,{children:"Install PostgreSQL 14 with the same configuration."}),"\n",(0,t.jsx)(n.li,{children:"Migrate the data."}),"\n",(0,t.jsx)(n.li,{children:"Scale up all Devtron components."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To monitor the progress of this job:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -f job/devtron-upgrade -n devtroncd\n"})}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"verify-the-upgrade",children:"Verify the Upgrade"}),"\n",(0,t.jsx)(n.p,{children:"After the upgrade job completes, verify the PostgreSQL migration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Check if all pods are running\nkubectl get pods -n devtroncd\n\n# Verify PostgreSQL version (should now be 14)\nkubectl get configmap devtron-postgres-upgrade -n devtroncd -o jsonpath="{.data.POSTGRES_MIGRATED}"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The value of ",(0,t.jsx)(n.code,{children:"POSTGRES_MIGRATED"}),' should be "14" if the migration was successful.']}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"potential-issues-and-troubleshooting",children:"Potential Issues and Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"job-failure",children:"Job Failure"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["If the ",(0,t.jsx)(n.code,{children:"devtron-upgrade-init"})," or the ",(0,t.jsx)(n.code,{children:"devtron-upgrade"})," job fails, check the logs of job and the ConfigMap for error messages:"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get configmap devtron-postgres-upgrade -n devtroncd -o yaml\n"})}),"\n",(0,t.jsx)(n.p,{children:'Look for any entries with "ERROR" in the keys.'}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["To reapply the devtron-upgrade-init job, delete the PVC named ",(0,t.jsx)(n.code,{children:"devtron-db-upgrade-pvc"}),", recreate it with the same configurations and then reapply the ",(0,t.jsx)(n.code,{children:"devtron-upgrade-init"})," job."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["If the ",(0,t.jsx)(n.code,{children:"devtron-upgrade-init"})," job is in a pending state, check for the PVC named ",(0,t.jsx)(n.code,{children:"devtron-db-upgrade-pvc"}),", ensure that the PVC is successfully created."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.hr,{}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.p,{children:["Once the database migration is complete, you can proceed with upgrading the Devtron application through the UI as mentioned in the final message of the upgrade job. Alternatively, you may use the ",(0,t.jsx)(n.a,{href:"#upgrade-commands",children:"upgrade commands"})," mentioned below."]}),"\n",(0,t.jsx)(n.h3,{id:"upgrade-commands",children:"Upgrade Commands"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Update the Helm repository"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm repo update\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsx)(n.li,{children:"Run the upgrade command for Devtron"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"helm upgrade devtron devtron/devtron-operator -n devtroncd --reuse-values -f https://raw.githubusercontent.com/devtron-labs/devtron/refs/tags/v1.5.1/charts/devtron/devtron-bom.yaml --version 0.22.93\n"})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}}}]);